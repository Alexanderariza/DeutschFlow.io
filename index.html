<!DOCTYPE html>
<html lang="es">
<head>
 
    <link rel="icon" href="icon-64.png" type="image/png">
<link rel="apple-touch-icon" href="icon-192.png">
<link rel="manifest" href="./manifest.json">


    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üá©üá™ Maestro Alem√°n Pro</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap');
        
        :root {
            --primary: #1e3a8a;
            --secondary: #3b82f6;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --purple: #8b5cf6;
            --pink: #ec4899;
            --pons-green: #008a51;
            --pons-blue: #a3c9d9;
            --highlight-red: #e74c3c;
            --modal-orange: #f39c12;
            --dark: #2c3e50;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 1rem;
            color: #1e293b;
            overflow-x: hidden;
        }
        
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }
        
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            animation: float 20s infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0) translateX(0); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(-100vh) translateX(50px); opacity: 0; }
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }
        
        .header {
            background: linear-gradient(135deg, rgba(30, 58, 138, 0.95), rgba(139, 92, 246, 0.95));
            backdrop-filter: blur(20px);
            border-radius: 2rem;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: pulse 3s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
        
        .header h1 {
            color: white;
            font-size: 2.5rem;
            font-weight: 900;
            text-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            position: relative;
            z-index: 1;
            margin-bottom: 1.5rem;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            position: relative;
            z-index: 1;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 1rem;
            padding: 1.2rem;
            text-align: center;
            transform: translateY(0);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
        }
        
        .stat-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            display: block;
        }
        
        .stat-label {
            font-size: 0.75rem;
            color: #64748b;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .stat-value {
            display: block;
            font-size: 2rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary), var(--purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-top: 0.5rem;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 1.5rem;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.5);
            animation: slideUp 0.5s ease-out;
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        #verbGrid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }
        
        .verb-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
        }
        
        .verb-dot {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #e2e8f0, #cbd5e1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-size: 1.2rem;
            cursor: pointer;
            position: relative;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .verb-dot:hover {
            transform: scale(1.15);
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.2);
        }
        
        .verb-dot.current {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            border: 3px solid white;
            transform: scale(1.2);
            box-shadow: 0 8px 30px rgba(245, 158, 11, 0.4);
            animation: currentPulse 2s ease-in-out infinite;
        }
        
        @keyframes currentPulse {
            0%, 100% { box-shadow: 0 8px 30px rgba(245, 158, 11, 0.4); }
            50% { box-shadow: 0 8px 40px rgba(245, 158, 11, 0.6); }
        }
        
        .verb-dot.completed {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            box-shadow: 0 4px 20px rgba(16, 185, 129, 0.4);
        }
        
        .verb-dot.completed::after {
            content: '‚úì';
            position: absolute;
            font-size: 1.5rem;
            color: white;
        }
        
        .verb-label {
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--primary);
            text-align: center;
        }

        /* --- RULETA INTERACTIVA INTEGRADA --- */
        .wheel-section {
            background: white;
            border-radius: 1rem;
            padding: 1.5rem;
            margin: 1.5rem 0;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .wheel-section h3 {
            color: var(--pons-green);
            margin-bottom: 1rem;
            text-align: center;
            font-size: 1.5rem;
        }
        
        .wheel-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            margin: 0 auto;
        }
        
        #wheel-container {
            position: relative;
            width: 380px;
            height: 380px;
            border-radius: 50%;
            background: var(--pons-blue);
            border: 12px solid #333;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            cursor: grab;
            display: flex;
            justify-content: center;
            align-items: center;
            touch-action: none;
            transition: transform 0.2s ease-out;
            margin: 0 auto;
        }
        
        .verb-label-wheel {
            position: absolute;
            width: 100%;
            text-align: right;
            padding-right: 40px;
            font-weight: 800;
            text-transform: uppercase;
            pointer-events: none;
            font-size: 1rem;
            color: var(--dark);
        }
        
        .pointer-arrow {
            position: absolute;
            right: -20px;
            top: 50%;
            transform: translateY(-50%);
            width: 50px;
            height: 30px;
            background: var(--pons-green);
            clip-path: polygon(0% 50%, 100% 0%, 100% 100%);
            z-index: 10;
        }
        
        /* Panel de conjugaci√≥n de la ruleta */
        .wheel-conjugation-panel {
            background: #f8fafc;
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border-top: 8px solid var(--pons-green);
            margin-top: 1.5rem;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .verb-header-wheel {
            text-align: center; 
            margin-bottom: 15px; 
        }
        
        .verb-header-wheel h4 { 
            font-size: 2rem; 
            color: var(--pons-green); 
            margin: 0; 
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .verb-header-wheel small { 
            font-size: 0.9em; 
            color: #666; 
            display: block; 
            margin-top: 5px; 
        }
        
        .verb-header-wheel .modal-tag {
            background: var(--modal-orange);
            color: white;
            padding: 4px 8px;
            border-radius: 5px;
            font-size: 0.7em;
            margin-left: 10px;
            vertical-align: middle;
        }
        
        .tense-grid-wheel {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 12px;
        }
        
        .tense-box-wheel {
            background: white;
            padding: 12px;
            border-radius: 10px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .tense-box-wheel h5 {
            font-size: 0.8rem;
            margin: 0 0 8px 0;
            color: var(--pons-green);
            text-transform: uppercase;
            border-bottom: 2px solid var(--pons-blue);
            padding-bottom: 5px;
        }
        
        .row-wheel { 
            display: flex; 
            justify-content: space-between; 
            font-size: 0.85rem; 
            padding: 3px 0; 
        }
        
        .pronoun-wheel { 
            color: #64748b; 
            font-style: italic; 
            min-width: 60px;
        }
        
        .form-wheel { 
            font-weight: 700; 
            color: var(--dark);
        }
        
        .diff-wheel { 
            color: var(--highlight-red); 
            font-weight: 800;
        }
        
        .fixed-infinitive-wheel { 
            color: var(--pons-green); 
            font-weight: bold; 
        }
        
        /* Tablas de conjugaci√≥n fijas para SEIN y HABEN */
        .fixed-conjugation-tables {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin: 2rem 0;
        }
        
        .conjugation-table {
            background: white;
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            border-top: 6px solid var(--secondary);
        }
        
        .conjugation-table h4 {
            color: var(--primary);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.3rem;
        }
        
        .table-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
        }
        
        .table-row {
            padding: 0.5rem;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .table-row.pronoun {
            font-style: italic;
            color: #64748b;
            font-weight: 600;
        }
        
        .table-row.form {
            font-weight: 700;
            color: var(--dark);
        }
        
        /* Teor√≠a de tiempos verbales */
        .theory-section {
            background: linear-gradient(135deg, #f8fafc, #f1f5f9);
            border-radius: 1rem;
            padding: 1.5rem;
            margin: 2rem 0;
            border-left: 6px solid var(--purple);
        }
        
        .theory-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 1.5rem;
            margin-top: 1rem;
        }
        
        .theory-card {
            background: white;
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border-top: 4px solid var(--secondary);
        }
        
        .theory-card h5 {
            color: var(--primary);
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .theory-card p {
            color: #475569;
            line-height: 1.5;
            font-size: 0.95rem;
        }
        
        /* Practice inputs */
        .practice-section {
            margin-top: 2rem;
        }
        
        .practice-card {
            background: white;
            border: 3px solid #e2e8f0;
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .practice-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.1), transparent);
            transition: left 0.5s;
        }
        
        .practice-card:hover::before {
            left: 100%;
        }
        
        .memo-input {
            width: 100%;
            padding: 1rem 1.5rem;
            border: 2px solid #cbd5e1;
            border-radius: 0.75rem;
            font-weight: 600;
            font-size: 1.2rem;
            margin: 0.5rem 0;
            transition: all 0.3s;
            font-family: 'Inter', sans-serif;
        }
        
        .memo-input:focus {
            outline: none;
            border-color: var(--purple);
            box-shadow: 0 0 0 4px rgba(139, 92, 246, 0.1);
            transform: scale(1.02);
        }
        
        .memo-input.correct {
            border-color: var(--success);
            background: linear-gradient(to right, #dcfce7, #f0fdf4);
            animation: successShake 0.5s;
        }
        
        @keyframes successShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        
        .hint-btn {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            padding: 0.6rem 1.2rem;
            border-radius: 0.5rem;
            border: none;
            color: white;
            font-weight: 700;
            cursor: pointer;
            font-size: 0.9rem;
            box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3);
            transition: all 0.3s;
        }
        
        .hint-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.4);
        }
        
        .hint-box {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
            border-left: 4px solid var(--warning);
            animation: slideUp 0.3s ease-out;
        }
        
        .feedback-box {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
        }
        
        .feedback-box.success {
            background: linear-gradient(135deg, #dcfce7, #bbf7d0);
            color: #166534;
            border-left: 4px solid var(--success);
        }
        
        .feedback-box.info {
            background: linear-gradient(135deg, #dbeafe, #bfdbfe);
            color: #1e40af;
            border-left: 4px solid var(--secondary);
        }
        
        .feedback-box.warning {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            color: #92400e;
            border-left: 4px solid var(--warning);
        }
        
        /* Drag & Drop */
        .drop-zone {
            min-height: 120px;
            background: linear-gradient(135deg, #f8fafc, #f1f5f9);
            border: 3px dashed var(--secondary);
            border-radius: 1rem;
            padding: 1.5rem;
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin: 1.5rem 0;
            align-items: center;
            transition: all 0.3s;
        }
        
        .drop-zone.drag-over {
            background: linear-gradient(135deg, #dbeafe, #bfdbfe);
            border-color: var(--purple);
            transform: scale(1.02);
        }
        
        .word {
            padding: 1rem 1.5rem;
            background: white;
            border: 2px solid var(--secondary);
            border-radius: 0.75rem;
            cursor: grab;
            font-weight: 700;
            font-size: 1.1rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.2s;
            user-select: none;
        }
        
        .word:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }
        
        .word:active {
            cursor: grabbing;
            transform: scale(0.95);
        }
        
        /* Matching */
        .match-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        .match-item {
            padding: 1.5rem;
            border: 3px solid #e2e8f0;
            border-radius: 1rem;
            cursor: pointer;
            text-align: center;
            font-weight: 700;
            font-size: 1.05rem;
            transition: all 0.3s;
            background: white;
        }
        
        .match-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
        }
        
        .match-item.selected {
            border-color: var(--purple);
            background: linear-gradient(135deg, #f5f3ff, #ede9fe);
            transform: scale(1.05);
        }
        
        .match-item.correct {
            background: linear-gradient(135deg, var(--success), #059669);
            color: white;
            border-color: var(--success);
            pointer-events: none;
            animation: correctMatch 0.6s;
        }
        
        @keyframes correctMatch {
            0% { transform: scale(1); }
            50% { transform: scale(1.1) rotate(5deg); }
            100% { transform: scale(1) rotate(0); }
        }
        
        /* Buttons */
        button {
            padding: 1.2rem 2rem;
            border: none;
            border-radius: 1rem;
            color: white;
            font-weight: 700;
            cursor: pointer;
            font-size: 1.1rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
            font-family: 'Inter', sans-serif;
        }
        
        button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        button:hover::before {
            width: 300px;
            height: 300px;
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
        }
        
        button:active {
            transform: translateY(-1px);
        }
        
        .btn-green {
            background: linear-gradient(135deg, var(--success), #059669);
        }
        
        .btn-blue {
            background: linear-gradient(135deg, var(--secondary), #2563eb);
        }
        
        .btn-purple {
            background: linear-gradient(135deg, var(--purple), #7c3aed);
        }
        
        .progress-container {
            width: 100%;
            height: 12px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 1rem;
            overflow: hidden;
            margin-top: 1rem;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--success), var(--purple));
            border-radius: 1rem;
            transition: width 0.5s ease-out;
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.5);
        }
        
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: var(--warning);
            animation: confetti-fall 3s linear forwards;
            z-index: 9999;
        }
        
        @keyframes confetti-fall {
            to {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }
        
        .hidden { display: none !important; }
        
        @media (max-width: 768px) {
            .header h1 { font-size: 1.8rem; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            #verbGrid { grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); }
            .verb-dot { width: 50px; height: 50px; }
            #wheel-container { width: 300px; height: 300px; }
            .tense-grid-wheel { grid-template-columns: 1fr; }
            .wheel-conjugation-panel { padding: 1rem; }
            .fixed-conjugation-tables { grid-template-columns: 1fr; }
            .theory-grid { grid-template-columns: 1fr; }
        }
        
        @media (max-width: 480px) {
            #wheel-container { width: 250px; height: 250px; }
            .verb-label-wheel { font-size: 0.8rem; }
        }

        /* Estilos mejorados para tablas de conjugaci√≥n completa */
.full-conjugation-table {
    background: white;
    border-radius: 0.75rem;
    padding: 1rem;
    margin-bottom: 1rem;
    border: 1px solid #e2e8f0;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}

.conjugation-row {
    display: flex;
    justify-content: space-between;
    padding: 0.5rem 0;
    border-bottom: 1px solid #f1f5f9;
    font-size: 0.9rem;
}

.conjugation-row:last-child {
    border-bottom: none;
}

.conjugation-pronoun {
    color: #64748b;
    font-style: italic;
    min-width: 80px;
    font-weight: 600;
}

.conjugation-form {
    font-weight: 700;
    color: var(--dark);
    text-align: right;
    flex-grow: 1;
    margin-left: 1rem;
}

/* Ajustes para m√≥viles */
@media (max-width: 768px) {
    .conjugation-row {
        font-size: 0.8rem;
        padding: 0.4rem 0;
    }
    
    .conjugation-pronoun {
        min-width: 70px;
    }
}

/* Estilos para resaltar cambios en conjugaciones */
.conjugation-highlight {
    background: linear-gradient(135deg, #fef3c7, #fde68a);
    padding: 4px 8px;
    border-radius: 4px;
    font-weight: 800;
    color: #92400e;
    display: inline-block;
    min-width: 80px;
    text-align: center;
}

.tense-highlight {
    color: #1e40af;
    font-weight: 900;
    background: #dbeafe;
    padding: 1px 4px;
    border-radius: 3px;
}

.perfekt-highlight {
    color: #065f46;
    font-weight: 900;
    background: #d1fae5;
    padding: 1px 4px;
    border-radius: 3px;
}

.futur-highlight {
    color: #7c3aed;
    font-weight: 900;
    background: #ede9fe;
    padding: 1px 4px;
    border-radius: 3px;
}

.infinitiv-highlight {
    color: #dc2626;
    font-weight: 900;
    background: #fee2e2;
    padding: 1px 4px;
    border-radius: 3px;
}

.change-highlight {
    background: linear-gradient(135deg, #fef3c7, #fde68a);
    padding: 2px 6px;
    border-radius: 4px;
    font-weight: bold;
    color: #92400e;
}

/* Mejoras para las tablas */
.table-row.form {
    font-weight: 700;
    color: var(--dark);
    text-align: center;
}

/* Estilos para explicaciones te√≥ricas */
.tense-explanation {
    background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
    padding: 1rem;
    border-radius: 0.75rem;
    border-left: 4px solid var(--secondary);
    margin-bottom: 1.5rem;
}

.pattern-note {
    font-size: 0.75rem;
    color: #64748b;
    font-style: italic;
    margin-top: 0.5rem;
    padding-top: 0.5rem;
    border-top: 1px dashed #e2e8f0;
}

.theory-box {
  background: linear-gradient(135deg, #f0f8ff 0%, #e6f7ff 100%);
  border: 2px solid #4a9eff;
  border-radius: 15px;
  padding: 20px;
  margin-bottom: 30px;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.theory-content h3 {
  color: #2c5282;
  margin-top: 0;
  border-bottom: 2px solid #90cdf4;
  padding-bottom: 10px;
}

.theory-main p {
  margin: 8px 0;
  line-height: 1.5;
}

.theory-tips {
  background: #fff8e1;
  border-left: 4px solid #ffc107;
  padding: 15px;
  margin: 15px 0;
  border-radius: 0 8px 8px 0;
}

.theory-tips h4 {
  color: #ff9800;
  margin-top: 0;
}

.toggle-theory-btn {
  background: #4a9eff;
  color: white;
  border: none;
  padding: 8px 16px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: bold;
  transition: background 0.3s;
}

.toggle-theory-btn:hover {
  background: #3182ce;
}

.verb-tip {
  background: #f0fff4;
  border: 1px solid #9ae6b4;
  border-radius: 8px;
  padding: 10px;
  margin: 10px 0;
  color: #22543d;
  font-style: italic;
}

    
/* === PEDAGOGICAL UI LAYER (NO JS IMPACT) === */
:root{
  --bg-main:#f7f8fa;
  --bg-card:#ffffff;
  --color-primary:#1f4fd8;
  --color-secondary:#e8ecff;
  --color-success:#2e7d32;
  --color-warning:#f9a825;
  --color-text:#1c1c1c;
  --radius:14px;
}

body{
  background:var(--bg-main);
  color:var(--color-text);
  line-height:1.6;
}

h1,h2,h3{
  letter-spacing:0.3px;
}

section, .card, .panel{
  background:var(--bg-card);
  border-radius:var(--radius);
  box-shadow:0 6px 18px rgba(0,0,0,.06);
  padding:1rem 1.2rem;
  margin-bottom:1rem;
}

/* Learning hierarchy */
.theory, .explanation{
  border-left:6px solid var(--color-primary);
  background:var(--color-secondary);
}

.exercise{
  border-left:6px solid var(--color-warning);
}

.feedback, .result, .success{
  border-left:6px solid var(--color-success);
}

/* Buttons */
button{
  border-radius:10px;
  font-weight:600;
}

/* Pedagogical hints */
.hint::before{
  content:"üí° ";
}

/* Responsive clarity */
@media(max-width:768px){
  body{
    font-size:15px;
  }
}


/* === LEVEL 2: ADAPTIVE PEDAGOGY (NON-INTRUSIVE) === */

/* Dark mode variables */
body.dark{
  --bg-main:#121212;
  --bg-card:#1e1e1e;
  --color-text:#f1f1f1;
  --color-secondary:#1a237e;
}

/* Dark toggle button */
#darkToggle{
  position:fixed;
  top:12px;
  right:12px;
  z-index:999;
  padding:.5rem .8rem;
  border-radius:999px;
  background:#000;
  color:#fff;
  cursor:pointer;
  font-size:13px;
}

/* Focus reinforcement */
.focus{
  animation:pulse 1.5s infinite;
}
@keyframes pulse{
  0%{box-shadow:0 0 0 0 rgba(31,79,216,.4)}
  70%{box-shadow:0 0 0 12px rgba(31,79,216,0)}
  100%{box-shadow:0 0 0 0 rgba(31,79,216,0)}
}

/* Micro-progress cue */
.progress-hint{
  font-size:13px;
  opacity:.75;
  margin-top:.5rem;
}

</style>
</head>
<body>
    <div class="particles" id="particles"></div>
    
    <div class="container">
        <div class="header">
            <h1>DeutschFlow</h1>
            <div class="stats-grid">
                <div class="stat-card">
                    <span class="stat-icon">üî•</span>
                    <span class="stat-label">Racha</span>
                    <span class="stat-value" id="streak">0</span>
                </div>
                <div class="stat-card">
                    <span class="stat-icon">‚úÖ</span>
                    <span class="stat-label">Aciertos</span>
                    <span class="stat-value" id="corrects">0</span>
                </div>
                <div class="stat-card">
                    <span class="stat-icon">üìà</span>
                    <span class="stat-label">Progreso</span>
                    <span class="stat-value" id="progreso">0/0</span>
                </div>
                <div class="stat-card">
                    <span class="stat-icon">‚≠ê</span>
                    <span class="stat-label">Puntos XP</span>
                    <span class="stat-value" id="xp">0</span>
                </div>
            </div>
            <div class="progress-container">
                <div class="progress-bar" id="progressBar" style="width: 0%"></div>
            </div>
        </div>

        <div class="card">
            <h2 style="color: var(--primary); margin-bottom: 1rem;">üéØ Selecciona tu verbo</h2>
            <div id="verbGrid"></div>
        </div>

        <div id="phase1" class="card hidden">
            <div id="learningContent"></div>
        </div>

<!-- En el HTML, a√±ade esto despu√©s del header o donde quieras mostrar la teor√≠a -->
<div id="theory-container" class="theory-box" style="display: none;"></div>

<!-- EL RESTO DE TU C√ìDIGO QUEDA IGUAL -->
<div class="card">
    <h2 style="color: var(--primary); margin-bottom: 1rem;">üéØ Selecciona tu verbo</h2>
    <div id="verbGrid"></div>
</div>

        <div id="phase2" class="card hidden">
            <h2 id="p2Verb" style="color: var(--primary);"></h2>
            <h3 id="p2Tense" style="color: var(--purple); margin: 0.5rem 0;"></h3>
            <p style="margin: 1rem 0; font-size: 1.1rem;">
                üéØ <b>Traduce:</b> <span id="p2Trans" style="font-style: italic; color: var(--secondary);"></span>
            </p>
            <div class="drop-zone" id="dropZone" ondrop="drop(event)" ondragover="allowDrop(event)" ondragleave="dragLeave(event)"></div>
            <div id="wordBank" style="display: flex; flex-wrap: wrap; gap: 12px;"></div>
            <button class="btn-green" style="margin-top: 1.5rem;" onclick="checkSentence()">Comprobar "Satzklammer" ‚úÖ</button>
            <div id="explanationBox" class="hidden" style="margin-top: 1.5rem; padding: 2rem; background: linear-gradient(135deg, #f0fdf4, #dcfce7); border-radius: 1rem; border-left: 8px solid var(--success);">
                <p id="explText" style="font-size: 1.05rem; line-height: 1.6;"></p>
                <button class="btn-blue" style="margin-top: 1.5rem;" onclick="nextTense()">Siguiente tiempo verbal ‚Üí</button>
            </div>
        </div>

        <div id="phase3" class="card hidden">
            <h2 style="text-align: center; color: var(--purple); margin-bottom: 2rem;">üîó Consolidaci√≥n: Uso</h2>
            <div class="match-grid" id="matchGrid"></div>
            <button id="btnP3" class="btn-green hidden" style="margin-top: 2rem;" onclick="finishVerb()">¬°Verbo Completado! üèÜ</button>
        </div>
        
        <div style="text-align: center; margin-top: 2rem;">
            <input type="file" id="imp" class="hidden" accept=".json" onchange="importJSON(event)">
            <button onclick="document.getElementById('imp').click()" 
                    style="background: linear-gradient(135deg, var(--secondary), #2563eb);">
                üìÅ Cargar JSON Personalizado
            </button>
        </div>
    </div>

    <script>
        // Variables globales
        let exercises = [];
        let currentVerbIdx = 0;
        let currentTenseIdx = 0;
        let streak = 0;
        let totalCorrect = 0;
        let xp = 0;
        let completed = new Set();
        let selectedQ = null;
        let currentStep = 'learn';
        
        // Variables para la ruleta
        let wheel = null;
        let currentRot = 0;
        let isDragging = false;
        let startAngle = 0;
        
        // Datos fijos para SEIN y HABEN
        const fixedVerbs = {
            sein: {
                name: "sein (ser/estar)",
                emoji: "üåü",
                conjugations: {
                    pr√§sens: ["ich bin", "du bist", "er/sie/es ist", "wir sind", "ihr seid", "sie/Sie sind"],
                    pr√§teritum: ["ich war", "du warst", "er/sie/es war", "wir waren", "ihr wart", "sie/Sie waren"],
                    perfekt: ["ich bin gewesen", "du bist gewesen", "er/sie/es ist gewesen", "wir sind gewesen", "ihr seid gewesen", "sie/Sie sind gewesen"],
                    futur: ["ich werde sein", "du wirst sein", "er/sie/es wird sein", "wir werden sein", "ihr werdet sein", "sie/Sie werden sein"]
                }
            },
            haben: {
                name: "haben (tener)",
                emoji: "ü§≤",
                conjugations: {
                    pr√§sens: ["ich habe", "du hast", "er/sie/es hat", "wir haben", "ihr habt", "sie/Sie haben"],
                    pr√§teritum: ["ich hatte", "du hattest", "er/sie/es hatte", "wir hatten", "ihr hattet", "sie/Sie hatten"],
                    perfekt: ["ich habe gehabt", "du hast gehabt", "er/sie/es hat gehabt", "wir haben gehabt", "ihr habt gehabt", "sie/Sie haben gehabt"],
                    futur: ["ich werde haben", "du wirst haben", "er/sie/es wird haben", "wir werden haben", "ihr werdet haben", "sie/Sie werden haben"]
                }
            }
        };

        function init() {
            createParticles();
            const saved = localStorage.getItem('germanModals_v3');
            if (saved) {
                const data = JSON.parse(saved);
                exercises = data.exercises || [];
                completed = new Set(data.completed || []);
                streak = data.streak || 0;
                totalCorrect = data.totalCorrect || 0;
                xp = data.xp || 0;
            }
            
            updateUI();
        }

        function createParticles() {
            const container = document.getElementById('particles');
            for (let i = 0; i < 30; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 20 + 's';
                particle.style.animationDuration = (15 + Math.random() * 10) + 's';
                container.appendChild(particle);
            }
        }

        function updateUI() {
            document.getElementById('streak').innerText = streak;
            document.getElementById('corrects').innerText = totalCorrect;
            document.getElementById('xp').innerText = xp;
            document.getElementById('progreso').innerText = `${completed.size}/${exercises.length}`;
            
            const progress = exercises.length > 0 ? (completed.size / exercises.length) * 100 : 0;
            document.getElementById('progressBar').style.width = progress + '%';
            
            renderGrid();
        }

function renderGrid() {
    const grid = document.getElementById('verbGrid');
    grid.innerHTML = '';
    
    // Filtrar solo los verbos reales (excluyendo la teor√≠a)
    const realVerbs = exercises.filter(ex => ex.type !== "theory");
    
    realVerbs.forEach((ex, originalIndex) => {
        // Encontrar el √≠ndice original en el array completo
        const actualIndex = exercises.findIndex(e => e === ex);
        
        const container = document.createElement('div');
        container.className = 'verb-container';
        
        const dot = document.createElement('div');
        dot.className = `verb-dot ${completed.has(actualIndex) ? 'completed' : ''} ${actualIndex === currentVerbIdx ? 'current' : ''}`;
        dot.innerText = completed.has(actualIndex) ? '' : (originalIndex + 1);
        dot.onclick = () => {
            currentVerbIdx = actualIndex;
            currentTenseIdx = 0;
            currentStep = 'learn';
            loadPhase1();
        };
        
        const label = document.createElement('span');
        label.className = 'verb-label';
        label.innerText = ex.verb.split(' ')[0];
        
        container.appendChild(dot);
        container.appendChild(label);
        grid.appendChild(container);
    });
}


function init() {
    createParticles();
    const saved = localStorage.getItem('germanModals_v3');
    if (saved) {
        const data = JSON.parse(saved);
        exercises = data.exercises || [];
        completed = new Set(data.completed || []);
        streak = data.streak || 0;
        totalCorrect = data.totalCorrect || 0;
        xp = data.xp || 0;
    }
    
    // Verificar si hay teor√≠a y mostrarla
    loadTheory();
    
    updateUI();
}

function loadTheory() {
    const theoryContainer = document.getElementById('theory-container');
    if (!theoryContainer) return;
    
    // Verificar si el primer elemento es teor√≠a
    if (exercises[0] && exercises[0].type === "theory") {
        const theory = exercises[0];
        theoryContainer.style.display = 'block';
        
        const theoryHTML = `
            <div class="theory-content">
                <h3>${theory.emoji || 'üìò'} ${theory.theory.title}</h3>
                <div class="theory-main">
                    ${theory.theory.content.map(item => `<p>${item}</p>`).join('')}
                </div>
                <div class="theory-tips">
                    <h4>üí° Consejos importantes:</h4>
                    ${theory.theory.tips.map(tip => `<p>${tip}</p>`).join('')}
                </div>
                <button onclick="toggleTheory()" class="toggle-theory-btn">
                    Ocultar teor√≠a
                </button>
            </div>
        `;
        theoryContainer.innerHTML = theoryHTML;
    } else {
        theoryContainer.style.display = 'none';
    }
}

// Funci√≥n para mostrar/ocultar teor√≠a
function toggleTheory() {
    const theoryContainer = document.getElementById('theory-container');
    const btn = theoryContainer.querySelector('.toggle-theory-btn');
    
    if (theoryContainer.style.display === 'none') {
        theoryContainer.style.display = 'block';
        btn.textContent = 'Ocultar teor√≠a';
    } else {
        theoryContainer.style.display = 'none';
        btn.textContent = 'Mostrar teor√≠a';
    }
}


function loadVerbs() {
  const theoryContainer = document.getElementById('theory-container');
  const verbsContainer = document.getElementById('verbs-container');
  
  theoryContainer.innerHTML = '';
  verbsContainer.innerHTML = '';
  
  // Cargar teor√≠a primero (si existe)
  if (modalesData[0] && modalesData[0].type === "theory") {
    const theory = modalesData[0];
    theoryContainer.style.display = 'block';
    
    const theoryHTML = `
      <div class="theory-content">
        <h3>${theory.emoji} ${theory.theory.title}</h3>
        <div class="theory-main">
          ${theory.theory.content.map(item => `<p>${item}</p>`).join('')}
        </div>
        <div class="theory-tips">
          <h4>üí° Consejos importantes:</h4>
          ${theory.theory.tips.map(tip => `<p>${tip}</p>`).join('')}
        </div>
        <button onclick="toggleTheory()" class="toggle-theory-btn">
          Ocultar teor√≠a
        </button>
      </div>
    `;
    theoryContainer.innerHTML = theoryHTML;
    
    // Empezar desde el √≠ndice 1 para saltar la teor√≠a
    var startIndex = 1;
  } else {
    theoryContainer.style.display = 'none';
    var startIndex = 0;
  }
  
  // Cargar los verbos normales
  for (let i = startIndex; i < modalesData.length; i++) {
    const verb = modalesData[i];
    const verbCard = document.createElement('div');
    verbCard.className = 'verb-card';
    
    // A√±adir el tip si existe
    const tipHTML = verb.tip ? `<div class="verb-tip">üí° ${verb.tip}</div>` : '';
    
    verbCard.innerHTML = `
      <h3>${verb.emoji} ${verb.verb}</h3>
      ${tipHTML}
      <!-- ... resto de tu HTML existente para el verbo ... -->
    `;
    
    verbsContainer.appendChild(verbCard);
  }
}

// Funci√≥n para mostrar/ocultar teor√≠a
function toggleTheory() {
  const theoryContainer = document.getElementById('theory-container');
  const btn = theoryContainer.querySelector('.toggle-theory-btn');
  
  if (theoryContainer.style.display === 'none') {
    theoryContainer.style.display = 'block';
    btn.textContent = 'Ocultar teor√≠a';
  } else {
    theoryContainer.style.display = 'none';
    btn.textContent = 'Mostrar teor√≠a';
  }
}


function getVerbType(verb) {
    // Primero verificar si tiene un tipo expl√≠cito
    if (verb.type) {
        return verb.type;
    }
    
    const verbName = verb.verb.toLowerCase().split(' ')[0];
    
    // Detectar verbos modales por nombre
    const modalVerbs = ['k√∂nnen', 'm√ºssen', 'd√ºrfen', 'wollen', 'sollen', 'm√∂gen'];
    if (modalVerbs.includes(verbName)) {
        return 'modal';
    }
    
    // Detectar verbos fuertes por cambios en las conjugaciones
    if (verb.conjugations && verb.conjugations.pr√§teritum) {
        const present = verb.conjugations.pr√§sens && verb.conjugations.pr√§sens[0];
        const past = verb.conjugations.pr√§teritum[0];
        
        if (present && past && !past.endsWith('te')) {
            // Verificar si hay cambio voc√°lico t√≠pico de verbos fuertes
            const strongPatterns = [
                { present: 'e', past: 'a' }, // geben ‚Üí gab
                { present: 'i', past: 'a' }, // sitzen ‚Üí sa√ü
                { present: 'ie', past: 'o' }, // biegen ‚Üí bog
                { present: 'ei', past: 'ie' }, // bleiben ‚Üí blieb
            ];
            
            for (const pattern of strongPatterns) {
                if (present.includes(pattern.present) && past.includes(pattern.past)) {
                    return 'strong';
                }
            }
        }
    }
    
    // Por defecto, asumir regular
    return 'regular';
}

        function getEssentialTenses(verb) {
            const essentialTenses = [];
            const tenses = verb.tenses || [];
            
            // Buscar Pr√§sens (Presente)
            const present = tenses.find(t => t.tense === 'Pr√§sens' || t.tense.includes('Presente') || t.tense.includes('Pr√§sens'));
            if (present) essentialTenses.push(present);
            
            // Buscar Perfekt (Pret√©rito Perfecto)
            const perfect = tenses.find(t => t.tense === 'Perfekt' || t.tense.includes('Perfecto') || t.tense.includes('Perfekt'));
            if (perfect) essentialTenses.push(perfect);
            
            // Buscar Futur I (Futuro)
            const future = tenses.find(t => t.tense === 'Futur I' || t.tense.includes('Futuro') || t.tense.includes('Futur'));
            if (future) essentialTenses.push(future);
            
            // Si no encuentra todos, tomar los primeros disponibles
            if (essentialTenses.length < 3) {
                const needed = 3 - essentialTenses.length;
                const additional = tenses.filter(t => !essentialTenses.includes(t)).slice(0, needed);
                essentialTenses.push(...additional);
            }
            
            return essentialTenses.slice(0, 3);
        }

function createFixedConjugationTables() {
    return `
        <div class="fixed-conjugation-tables">
            <!-- Tabla de SEIN con teor√≠a -->
            <div class="conjugation-table">
                <h4>${fixedVerbs.sein.emoji} ${fixedVerbs.sein.name}</h4>
                <p style="color: #475569; font-size: 0.95rem; margin-bottom: 1rem;">
                    <strong>Uso:</strong> Verbo de estado o existencia. Se usa como auxiliar con verbos de movimiento y cambio de estado.
                </p>
                <div class="table-grid">
                    <div class="table-row pronoun">Pronombre</div>
                    <div class="table-row pronoun">Conjugaci√≥n</div>
                    ${fixedVerbs.sein.conjugations.pr√§sens.map((conj, i) => {
                        const pronoun = ["ich", "du", "er/sie/es", "wir", "ihr", "sie/Sie"][i];
                        // Extraer solo la parte del verbo (sin el pronombre)
                        const verbPart = conj.replace(`${pronoun} `, '');
                        return `
                            <div class="table-row pronoun">${pronoun}</div>
                            <div class="table-row form">
                                <span class="conjugation-highlight">${verbPart}</span>
                            </div>
                        `;
                    }).join('')}
                </div>
                <div style="margin-top: 1rem; padding: 0.75rem; background: #f0f9ff; border-radius: 0.5rem; border-left: 3px solid var(--secondary);">
                    <strong style="color: var(--secondary);">üí° Recordar:</strong>
                    <p style="margin: 0.5rem 0 0 0; font-size: 0.9rem; color: #475569;">
                        ‚Ä¢ <strong>bin</strong> (yo soy/estoy)<br>
                        ‚Ä¢ <strong>bist</strong> (t√∫ eres/est√°s)<br>
                        ‚Ä¢ <strong>ist</strong> (√©l/ella/ello es/est√°)<br>
                        ‚Ä¢ Participio: <strong>gewesen</strong>
                    </p>
                </div>
            </div>
            
            <!-- Tabla de HABEN con teor√≠a -->
            <div class="conjugation-table">
                <h4>${fixedVerbs.haben.emoji} ${fixedVerbs.haben.name}</h4>
                <p style="color: #475569; font-size: 0.95rem; margin-bottom: 1rem;">
                    <strong>Uso:</strong> Verbo de posesi√≥n. Auxiliar principal para el Perfekt de la mayor√≠a de verbos.
                </p>
                <div class="table-grid">
                    <div class="table-row pronoun">Pronombre</div>
                    <div class="table-row pronoun">Conjugaci√≥n</div>
                    ${fixedVerbs.haben.conjugations.pr√§sens.map((conj, i) => {
                        const pronoun = ["ich", "du", "er/sie/es", "wir", "ihr", "sie/Sie"][i];
                        // Extraer solo la parte del verbo (sin el pronombre)
                        const verbPart = conj.replace(`${pronoun} `, '');
                        return `
                            <div class="table-row pronoun">${pronoun}</div>
                            <div class="table-row form">
                                <span class="conjugation-highlight">${verbPart}</span>
                            </div>
                        `;
                    }).join('')}
                </div>
                <div style="margin-top: 1rem; padding: 0.75rem; background: #f0fdf4; border-radius: 0.5rem; border-left: 3px solid var(--success);">
                    <strong style="color: var(--success);">üí° Recordar:</strong>
                    <p style="margin: 0.5rem 0 0 0; font-size: 0.9rem; color: #475569;">
                        ‚Ä¢ <strong>habe</strong> (yo tengo)<br>
                        ‚Ä¢ <strong>hast</strong> (t√∫ tienes)<br>
                        ‚Ä¢ <strong>hat</strong> (√©l/ella/ello tiene)<br>
                        ‚Ä¢ Participio: <strong>gehabt</strong>
                    </p>
                </div>
            </div>
        </div>
        
        <!-- Explicaci√≥n adicional -->
        <div style="margin-top: 2rem; padding: 1.5rem; background: linear-gradient(135deg, #f5f3ff, #ede9fe); border-radius: 1rem; border-left: 6px solid var(--purple);">
            <h5 style="color: var(--purple); margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
                üìö Diferencias clave entre SEIN y HABEN
            </h5>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
                <div>
                    <h6 style="color: var(--secondary); margin-bottom: 0.5rem;">üîµ SEIN se usa con:</h6>
                    <ul style="color: #475569; font-size: 0.9rem; padding-left: 1.2rem;">
                        <li>Verbos de movimiento (gehen, kommen, fahren)</li>
                        <li>Verbos de cambio de estado (werden, bleiben)</li>
                        <li>Verbos reflexivos de movimiento</li>
                        <li>Algunos verbos intransitivos</li>
                    </ul>
                </div>
                <div>
                    <h6 style="color: var(--success); margin-bottom: 0.5rem;">üü¢ HABEN se usa con:</h6>
                    <ul style="color: #475569; font-size: 0.9rem; padding-left: 1.2rem;">
                        <li>La mayor√≠a de verbos transitivos</li>
                        <li>Verbos modales (k√∂nnen, m√ºssen)</li>
                        <li>Verbos reflexivos (no de movimiento)</li>
                        <li>Verbos impersonales</li>
                    </ul>
                </div>
            </div>
        </div>
    `;
}

function createTheorySection() {
    return `
        <div class="theory-section">
            <h4 style="color: var(--purple); margin-bottom: 1rem;">üìö Fundamentos de la Conjugaci√≥n Alemana</h4>
            
            <div style="margin-bottom: 1.5rem; padding: 1rem; background: white; border-radius: 0.75rem; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                <p style="color: #475569; margin: 0; font-size: 0.95rem;">
                    <strong>üí° Consejo de estudio:</strong> En alem√°n, es m√°s importante memorizar 
                    <span class="change-highlight">las partes que cambian</span> que las formas completas. 
                    Observa los patrones en las tablas de abajo.
                </p>
            </div>
            
            <div class="theory-grid">
                <div class="theory-card">
                    <h5>üéØ Pr√§sens (Presente)</h5>
                    <p><strong>Formaci√≥n:</strong> Ra√≠z del verbo + terminaciones personales.</p>
                    <p><strong>Terminaciones t√≠picas:</strong></p>
                    <ul style="font-size: 0.9rem; color: #475569; margin-top: 0.5rem;">
                        <li><strong>-e</strong> (ich)</li>
                        <li><strong>-st</strong> (du)</li>
                        <li><strong>-t</strong> (er/sie/es)</li>
                        <li><strong>-en</strong> (wir, sie/Sie)</li>
                        <li><strong>-t</strong> (ihr)</li>
                    </ul>
                    <p class="pattern-note">En verbos fuertes, hay cambios voc√°licos en 2¬™ y 3¬™ persona singular.</p>
                </div>
                
                <div class="theory-card">
                    <h5>üìó Perfekt (Pret√©rito Perfecto)</h5>
                    <p><strong>Formaci√≥n:</strong> haben/sein + Participio Perfekt.</p>
                    <p><strong>Participio:</strong></p>
                    <ul style="font-size: 0.9rem; color: #475569; margin-top: 0.5rem;">
                        <li><strong>ge- + ra√≠z + -t</strong> (verbos regulares)</li>
                        <li><strong>ge- + ra√≠z modificada + -en</strong> (verbos fuertes)</li>
                    </ul>
                    <p><strong>¬øhaben o sein?</strong> Se usa 'sein' con verbos de movimiento y cambio de estado.</p>
                    <p class="pattern-note">El participio va al final de la oraci√≥n.</p>
                </div>
                
                <div class="theory-card">
                    <h5>üìô Futur I (Futuro)</h5>
                    <p><strong>Formaci√≥n:</strong> werden + Infinitivo.</p>
                    <p><strong>Conjugaci√≥n de werden:</strong></p>
                    <ul style="font-size: 0.9rem; color: #475569; margin-top: 0.5rem;">
                        <li><strong>ich werde</strong></li>
                        <li><strong>du wirst</strong></li>
                        <li><strong>er/sie/es wird</strong></li>
                        <li><strong>wir werden</strong></li>
                        <li><strong>ihr werdet</strong></li>
                        <li><strong>sie/Sie werden</strong></li>
                    </ul>
                    <p class="pattern-note">El infinitivo va al final de la oraci√≥n.</p>
                </div>
            </div>
            
            <!-- Secci√≥n de consejos visuales -->
            <div style="margin-top: 1.5rem; padding: 1.25rem; background: linear-gradient(135deg, #fdf2f8, #fce7f3); border-radius: 0.75rem; border-left: 4px solid var(--pink);">
                <h6 style="color: var(--pink); margin-bottom: 0.5rem;">üëÅÔ∏è Consejo Visual</h6>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.75rem; font-size: 0.85rem;">
                    <div>
                        <span style="display: inline-block; width: 12px; height: 12px; background: #dbeafe; border-radius: 2px; margin-right: 6px;"></span>
                        <strong>Azul:</strong> Terminaciones del presente
                    </div>
                    <div>
                        <span style="display: inline-block; width: 12px; height: 12px; background: #d1fae5; border-radius: 2px; margin-right: 6px;"></span>
                        <strong>Verde:</strong> Participio del perfecto
                    </div>
                    <div>
                        <span style="display: inline-block; width: 12px; height: 12px; background: #ede9fe; border-radius: 2px; margin-right: 6px;"></span>
                        <strong>Morado:</strong> Auxiliar werden (futuro)
                    </div>
                </div>
            </div>
        </div>
    `;
}

        function initWheel() {
            const wheelArea = document.getElementById('wheel-area');
            if (!wheelArea || exercises.length === 0) return;
            
            wheelArea.innerHTML = '';
            
            // Crear el contenedor de la ruleta
            const wheelDiv = document.createElement('div');
            wheelDiv.id = 'wheel-container';
            
            // Agregar event listeners para la ruleta
            wheelDiv.addEventListener('mousedown', startDrag);
            wheelDiv.addEventListener('touchstart', startDrag);
            
            wheelArea.appendChild(wheelDiv);
            
            wheel = document.getElementById('wheel-container');
            
            // Agregar verbos a la ruleta
            exercises.forEach((v, i) => {
                const div = document.createElement('div');
                div.className = 'verb-label-wheel';
                div.style.transform = `rotate(${i * (360 / exercises.length)}deg)`;
                div.innerHTML = v.verb.split(' ')[0];
                wheel.appendChild(div);
            });
            
            // Agregar la flecha indicadora
            const pointer = document.createElement('div');
            pointer.className = 'pointer-arrow';
            wheel.parentElement.appendChild(pointer);
            
            updateWheelDisplay();
        }

function updateWheelDisplay() {
    const displayPanel = document.getElementById('wheel-display-panel');
    if (!displayPanel || exercises.length === 0) return;
    
    let index = Math.round(-currentRot / (360 / exercises.length)) % exercises.length;
    if (index < 0) index += exercises.length;
    const v = exercises[index];
    const verbName = v.verb.split(' ')[0];
    const verbType = getVerbType(v);
    
    // Verificar si el verbo tiene conjugaciones completas
    const hasFullConjugations = v.conjugations && 
                               v.conjugations.pr√§sens && 
                               v.conjugations.pr√§sens.length === 6;
    
    if (hasFullConjugations) {
        // Funci√≥n para extraer y resaltar la parte que cambia
        const extractVerbPart = (fullConjugation, pronoun) => {
            return fullConjugation.replace(`${pronoun} `, '');
        };
        
        // Funci√≥n para resaltar terminaciones o cambios especiales
        const highlightChanges = (verbPart, tense) => {
            let highlighted = verbPart;
            
            // Resaltar terminaciones t√≠picas
            if (tense === 'pr√§sens') {
                // Resaltar terminaciones -st, -t, -en
                highlighted = highlighted
                    .replace(/(st)$/, '<span class="tense-highlight">$1</span>')
                    .replace(/(t)$/, '<span class="tense-highlight">$1</span>')
                    .replace(/(en)$/, '<span class="tense-highlight">$1</span>');
            } else if (tense === 'perfekt') {
                // Resaltar prefijo ge- y participio
                highlighted = highlighted
                    .replace(/^(ge)/, '<span class="perfekt-highlight">$1</span>')
                    .replace(/(t|en)$/, '<span class="perfekt-highlight">$1</span>');
            } else if (tense === 'futur') {
                // Resaltar werden y infinitivo
                const parts = highlighted.split(' ');
                if (parts.length === 2) {
                    highlighted = `<span class="futur-highlight">${parts[0]}</span> <span class="infinitiv-highlight">${parts[1]}</span>`;
                }
            }
            
            return highlighted;
        };
        
        const pronouns = ["ich", "du", "er/sie/es", "wir", "ihr", "sie/Sie"];
        
        displayPanel.innerHTML = `
            <div class="verb-header-wheel">
                <h4>${verbName}</h4>
                <small>Tipo: ${verbType.toUpperCase()} ‚Ä¢ ${v.emoji || 'üìö'}</small>
            </div>
            
            <div class="tense-explanation" style="margin-bottom: 1.5rem; padding: 1rem; background: #f8fafc; border-radius: 0.75rem; border-left: 4px solid var(--pons-green);">
                <p style="margin: 0; color: #475569; font-size: 0.9rem;">
                    <strong>üí° Atenci√≥n:</strong> Observa las partes <span class="change-highlight" style="background: #fef3c7; padding: 2px 6px; border-radius: 3px; font-weight: bold;">resaltadas</span> 
                    que cambian seg√∫n el pronombre y tiempo verbal.
                </p>
            </div>
            
            <div class="tense-grid-wheel">
                <!-- PRESENTE -->
                <div class="tense-box-wheel">
                    <h5>Pr√§sens <small style="color: #64748b; font-weight: normal;">(Presente)</small></h5>
                    ${v.conjugations.pr√§sens.map((form, i) => {
                        const pronoun = pronouns[i];
                        const verbPart = extractVerbPart(form, pronoun);
                        const highlightedPart = highlightChanges(verbPart, 'pr√§sens');
                        return `
                            <div class="row-wheel">
                                <span class="pronoun-wheel">${pronoun}</span>
                                <span class="form-wheel">${highlightedPart}</span>
                            </div>
                        `;
                    }).join('')}
                    <div style="margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px dashed #e2e8f0; font-size: 0.75rem; color: #64748b;">
                        <strong>üìù Patr√≥n:</strong> ${getTensePattern('pr√§sens', verbType)}
                    </div>
                </div>
                
                <!-- PERFECTO -->
                <div class="tense-box-wheel">
                    <h5>Perfekt <small style="color: #64748b; font-weight: normal;">(Perfecto)</small></h5>
                    ${v.conjugations.perfekt.map((form, i) => {
                        const pronoun = pronouns[i];
                        const verbPart = extractVerbPart(form, pronoun);
                        const highlightedPart = highlightChanges(verbPart, 'perfekt');
                        return `
                            <div class="row-wheel">
                                <span class="pronoun-wheel">${pronoun}</span>
                                <span class="form-wheel">${highlightedPart}</span>
                            </div>
                        `;
                    }).join('')}
                    <div style="margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px dashed #e2e8f0; font-size: 0.75rem; color: #64748b;">
                        <strong>üìù Patr√≥n:</strong> ${getTensePattern('perfekt', verbType)}
                    </div>
                </div>
                
                <!-- FUTURO -->
                <div class="tense-box-wheel">
                    <h5>Futur I <small style="color: #64748b; font-weight: normal;">(Futuro)</small></h5>
                    ${v.conjugations.futur.map((form, i) => {
                        const pronoun = pronouns[i];
                        const verbPart = extractVerbPart(form, pronoun);
                        const highlightedPart = highlightChanges(verbPart, 'futur');
                        return `
                            <div class="row-wheel">
                                <span class="pronoun-wheel">${pronoun}</span>
                                <span class="form-wheel">${highlightedPart}</span>
                            </div>
                        `;
                    }).join('')}
                    <div style="margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px dashed #e2e8f0; font-size: 0.75rem; color: #64748b;">
                        <strong>üìù Patr√≥n:</strong> ${getTensePattern('futur', verbType)}
                    </div>
                </div>
            </div>
            
            <!-- Nota sobre cambios voc√°licos -->
            ${verbType === 'strong' ? `
                <div style="margin-top: 1rem; padding: 1rem; background: linear-gradient(135deg, #fef3c7, #fde68a); border-radius: 0.75rem; border-left: 4px solid var(--warning);">
                    <strong style="color: #92400e;">‚ö†Ô∏è Verbo Fuerte:</strong>
                    <p style="margin: 0.5rem 0 0 0; font-size: 0.85rem; color: #92400e;">
                        Este verbo tiene cambios voc√°licos en el pasado (Pr√§teritum). 
                        Observa c√≥mo cambia la ra√≠z entre presente y pasado.
                    </p>
                </div>
            ` : ''}
        `;
    } else {
        // Modo fallback (para JSON antiguos)
        const essentialTenses = getEssentialTenses(v);
        
        displayPanel.innerHTML = `
            <div class="verb-header-wheel">
                <h4>${verbName}</h4>
                <small>Tipo: ${verbType.toUpperCase()}</small>
            </div>
            <div class="tense-grid-wheel">
                ${essentialTenses.map((tense, i) => `
                    <div class="tense-box-wheel">
                        <h5>${tense.tense}</h5>
                        <div class="row-wheel" style="justify-content: center; margin-top: 10px;">
                            <span class="form-wheel" style="font-size: 1.1rem;">
                                ${tense.correctSentence.slice(1).join(' ')}
                            </span>
                        </div>
                        <div class="row-wheel" style="margin-top: 8px; font-size: 0.85rem; color: #666; text-align: center;">
                            ${tense.translation}
                        </div>
                    </div>
                `).join('')}
            </div>
        `;
    }
}

function getTensePattern(tense, verbType) {
    const patterns = {
        pr√§sens: {
            strong: "Ra√≠z + terminaciones (-e, -st, -t, -en) con cambios voc√°licos en 2¬™/3¬™ persona",
            regular: "Ra√≠z + terminaciones fijas (-e, -st, -t, -en)",
            modal: "Ra√≠z irregular en singular, regular en plural",
            mixed: "Como regular en presente"
        },
        perfekt: {
            strong: "haben/bin + participio con ge- + ra√≠z modificada + -en",
            regular: "haben + participio con ge- + ra√≠z + -t",
            modal: "haben + participio (ge- + ra√≠z + -t)",
            mixed: "haben + participio irregular con -t"
        },
        futur: {
            strong: "werden + infinitivo",
            regular: "werden + infinitivo",
            modal: "werden + infinitivo",
            mixed: "werden + infinitivo"
        }
    };
    
    return patterns[tense]?.[verbType] || "Formaci√≥n regular";
}

function loadDefaultConjugations(verb) {
    // Crear conjugaciones por defecto basadas en el tipo de verbo
    const verbName = verb.verb.split(' ')[0];
    const verbType = getVerbType(verb);
    
    // Patrones b√°sicos de conjugaci√≥n
    const patterns = {
        strong: {
            pr√§sens: [
                `ich ${verbName}e`,
                `du ${verbName}st`,
                `er/sie/es ${verbName}t`,
                `wir ${verbName}en`,
                `ihr ${verbName}t`,
                `sie/Sie ${verbName}en`
            ],
            perfekt: [
                `ich bin ge${verbName}en`,
                `du bist ge${verbName}en`,
                `er/sie/es ist ge${verbName}en`,
                `wir sind ge${verbName}en`,
                `ihr seid ge${verbName}en`,
                `sie/Sie sind ge${verbName}en`
            ],
            futur: [
                `ich werde ${verbName}en`,
                `du wirst ${verbName}en`,
                `er/sie/es wird ${verbName}en`,
                `wir werden ${verbName}en`,
                `ihr werdet ${verbName}en`,
                `sie/Sie werden ${verbName}en`
            ]
        },
        regular: {
            pr√§sens: [
                `ich ${verbName}e`,
                `du ${verbName}st`,
                `er/sie/es ${verbName}t`,
                `wir ${verbName}en`,
                `ihr ${verbName}t`,
                `sie/Sie ${verbName}en`
            ],
            perfekt: [
                `ich habe ge${verbName}t`,
                `du hast ge${verbName}t`,
                `er/sie/es hat ge${verbName}t`,
                `wir haben ge${verbName}t`,
                `ihr habt ge${verbName}t`,
                `sie/Sie haben ge${verbName}t`
            ],
            futur: [
                `ich werde ${verbName}en`,
                `du wirst ${verbName}en`,
                `er/sie/es wird ${verbName}en`,
                `wir werden ${verbName}en`,
                `ihr werdet ${verbName}en`,
                `sie/Sie werden ${verbName}en`
            ]
        },
        modal: {
            pr√§sens: [
                `ich ${verbName}`,
                `du ${verbName}st`,
                `er/sie/es ${verbName}`,
                `wir ${verbName}en`,
                `ihr ${verbName}t`,
                `sie/Sie ${verbName}en`
            ],
            perfekt: [
                `ich habe ge${verbName}t`,
                `du hast ge${verbName}t`,
                `er/sie/es hat ge${verbName}t`,
                `wir haben ge${verbName}t`,
                `ihr habt ge${verbName}t`,
                `sie/Sie haben ge${verbName}t`
            ],
            futur: [
                `ich werde ${verbName}en`,
                `du wirst ${verbName}en`,
                `er/sie/es wird ${verbName}en`,
                `wir werden ${verbName}en`,
                `ihr werdet ${verbName}en`,
                `sie/Sie werden ${verbName}en`
            ]
        }
    };
    
    return patterns[verbType] || patterns.regular;
}

        // L√≥gica de rotaci√≥n de la ruleta
        function getAngle(x, y) {
            if (!wheel) return 0;
            const rect = wheel.getBoundingClientRect();
            const cx = rect.left + rect.width/2;
            const cy = rect.top + rect.height/2;
            return Math.atan2(y - cy, x - cx) * 180 / Math.PI;
        }

        function startDrag(e) {
            if (!wheel) return;
            isDragging = true;
            const p = e.touches ? e.touches[0] : e;
            startAngle = getAngle(p.clientX, p.clientY) - currentRot;
            wheel.style.transition = "none";
        }

        function doDrag(e) {
            if(!isDragging || !wheel) return;
            const p = e.touches ? e.touches[0] : e;
            currentRot = getAngle(p.clientX, p.clientY) - startAngle;
            wheel.style.transform = `rotate(${currentRot}deg)`;
            updateWheelDisplay();
        }

        function stopDrag() {
            if (!wheel) return;
            isDragging = false;
            const step = 360 / exercises.length;
            currentRot = Math.round(currentRot / step) * step;
            wheel.style.transition = "transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)";
            wheel.style.transform = `rotate(${currentRot}deg)`;
            updateWheelDisplay();
        }

        function loadPhase1() {
            hideAll();
            document.getElementById('phase1').classList.remove('hidden');
            const verb = exercises[currentVerbIdx];
            
            const content = document.getElementById('learningContent');
            content.innerHTML = '';
            
            // Header
            const header = document.createElement('div');
            header.style.textAlign = 'center';
            header.style.marginBottom = '2rem';
            header.innerHTML = `
                <div style="font-size: 3rem; margin-bottom: 1rem;">${verb.emoji || 'üìö'}</div>
                <h2 style="color: var(--purple); font-size: 2rem; margin-bottom: 0.5rem;">${verb.verb}</h2>
                <p style="color: #64748b; font-size: 1.1rem;">Paso 1: Aprende los tiempos verbales b√°sicos</p>
            `;
            content.appendChild(header);
            
            // Teor√≠a de tiempos verbales
            content.innerHTML += createTheorySection();
            
            // Tablas fijas de SEIN y HABEN
            content.innerHTML += createFixedConjugationTables();
            
            // --- RULETA INTERACTIVA ---
            const wheelSection = document.createElement('div');
            wheelSection.className = 'wheel-section';
            wheelSection.innerHTML = `
                <h3>üé° Ruleta Interactiva de Verbos</h3>
                <p style="text-align: center; color: #64748b; margin-bottom: 1.5rem;">
                    Gira la ruleta para explorar diferentes verbos alemanes y ver sus conjugaciones
                </p>
            `;
            
            const wheelArea = document.createElement('div');
            wheelArea.className = 'wheel-area';
            wheelArea.id = 'wheel-area';
            
            const wheelDisplay = document.createElement('div');
            wheelDisplay.className = 'wheel-conjugation-panel';
            wheelDisplay.id = 'wheel-display-panel';
            
            wheelSection.appendChild(wheelArea);
            wheelSection.appendChild(wheelDisplay);
            content.appendChild(wheelSection);
            
            // Inicializar la ruleta despu√©s de agregarla al DOM
            setTimeout(() => {
                if (exercises.length > 0) {
                    initWheel();
                }
            }, 100);
            
            // Bot√≥n para pasar a pr√°ctica
            const startBtn = document.createElement('button');
            startBtn.className = 'btn-purple';
            startBtn.style.width = '100%';
            startBtn.innerHTML = '‚úÖ Entendido, ¬°vamos a practicar!';
            startBtn.onclick = () => {
                currentStep = 'practice';
                startPhase2();
            };
            content.appendChild(startBtn);
        }

function startPhase2() {
    hideAll();
    document.getElementById('phase2').classList.remove('hidden');
    loadSentence();
}

function loadSentence() {
    // Asegurarse de que no estamos usando la teor√≠a
    const currentExercise = exercises[currentVerbIdx];
    if (currentExercise.type === "theory") {
        // Si accidentalmente estamos en teor√≠a, saltar al siguiente
        currentVerbIdx = 1; // Saltar a primer verbo real
        currentTenseIdx = 0;
    }
    
    const t = exercises[currentVerbIdx].tenses[currentTenseIdx];
    document.getElementById('p2Verb').innerText = exercises[currentVerbIdx].verb;
    document.getElementById('p2Tense').innerText = t.tense;
    document.getElementById('p2Trans').innerText = t.translation;
    document.getElementById('explanationBox').classList.add('hidden');
    
    const bank = document.getElementById('wordBank');
    bank.innerHTML = '';
    
    [...t.words].sort(() => Math.random() - 0.5).forEach((w, i) => {
        const d = document.createElement('div');
        d.className = 'word';
        d.innerText = w;
        d.draggable = true;
        d.id = `w-${i}`;
        d.ondragstart = (e) => {
            e.dataTransfer.setData("text", e.target.id);
            e.target.style.opacity = '0.5';
        };
        d.ondragend = (e) => {
            e.target.style.opacity = '1';
        };
        bank.appendChild(d);
    });
    
    document.getElementById('dropZone').innerHTML = '';
}

        function checkSentence() {
            const user = Array.from(document.querySelectorAll('#dropZone .word')).map(e => e.innerText);
            const correct = exercises[currentVerbIdx].tenses[currentTenseIdx].correctSentence;
            
            if (JSON.stringify(user) === JSON.stringify(correct)) {
                streak++;
                totalCorrect++;
                xp += 25;
                
                document.getElementById('explText').innerHTML = `
                    <b style="color: #10b981; font-size: 1.2rem;">¬°Correcto! üéâ</b><br><br>
                    <b>Oraci√≥n:</b> ${correct.join(' ')}<br><br>
                    üí° <b>Regla gramatical:</b><br>
                    ${exercises[currentVerbIdx].tenses[currentTenseIdx].explanation.grammar.join(' ')}
                `;
                document.getElementById('explanationBox').classList.remove('hidden');
                celebrate();
                save();
                updateUI();
            } else {
                streak = 0;
                showError("¬°Cuidado con la posici√≥n del verbo! Recuerda la Satzklammer üìö");
                save();
                updateUI();
            }
        }

        function nextTense() {
            currentTenseIdx++;
            if (currentTenseIdx >= exercises[currentVerbIdx].tenses.length) {
                startPhase3();
            } else {
                loadSentence();
            }
        }

        function startPhase3() {
            hideAll();
            document.getElementById('phase3').classList.remove('hidden');
            
            const grid = document.getElementById('matchGrid');
            grid.innerHTML = '';
            const v = exercises[currentVerbIdx];
            let hits = 0;
            
            v.matching.forEach(m => {
                const d = document.createElement('div');
                d.className = 'match-item q-item';
                d.innerText = m.q;
                d.onclick = () => {
                    document.querySelectorAll('.q-item').forEach(x => x.classList.remove('selected'));
                    d.classList.add('selected');
                    selectedQ = m.q;
                };
                grid.appendChild(d);
            });
            
            [...v.matching].sort(() => Math.random() - 0.5).forEach(obj => {
                const d = document.createElement('div');
                d.className = 'match-item';
                d.innerText = obj.a;
                d.onclick = () => {
                    if (!selectedQ) return;
                    
                    if (obj.a === v.matching.find(m => m.q === selectedQ).a) {
                        d.classList.add('correct');
                        document.querySelector('.q-item.selected').classList.add('correct');
                        hits++;
                        xp += 15;
                        updateUI();
                        
                        if (hits === v.matching.length) {
                            document.getElementById('btnP3').classList.remove('hidden');
                            celebrate();
                        }
                        selectedQ = null;
                    } else {
                        showError("¬°Intenta otra combinaci√≥n!");
                    }
                };
                grid.appendChild(d);
            });
        }

        function finishVerb() {
            completed.add(currentVerbIdx);
            xp += 50;
            bigCelebrate();
            
            setTimeout(() => {
                currentVerbIdx = (currentVerbIdx + 1) % exercises.length;
                currentTenseIdx = 0;
                currentStep = 'learn';
                save();
                updateUI();
                
                if (completed.size === exercises.length) {
                    showVictory();
                }
            }, 2000);
        }

        function hideAll() {
            ['phase1', 'phase2', 'phase3'].forEach(id => {
                document.getElementById(id).classList.add('hidden');
            });
        }

        function allowDrop(e) {
            e.preventDefault();
            document.getElementById('dropZone').classList.add('drag-over');
        }

        function dragLeave(e) {
            document.getElementById('dropZone').classList.remove('drag-over');
        }

        function drop(e) {
            e.preventDefault();
            document.getElementById('dropZone').classList.remove('drag-over');
            const id = e.dataTransfer.getData("text");
            const element = document.getElementById(id);
            if (element) {
                document.getElementById('dropZone').appendChild(element);
            }
        }

        function save() {
            localStorage.setItem('germanModals_v3', JSON.stringify({
                exercises,
                completed: Array.from(completed),
                streak,
                totalCorrect,
                xp
            }));
        }

function importJSON(e) {
    const reader = new FileReader();
    reader.onload = (ev) => {
        try {
            exercises = JSON.parse(ev.target.result);
            
            // Verificar y agregar conjugaciones si faltan
            exercises.forEach((verb, index) => {
                if (verb.type !== "theory" && !verb.conjugations) {
                    // Intentar generar conjugaciones por defecto solo para verbos
                    const defaultConjugations = loadDefaultConjugations(verb);
                    exercises[index].conjugations = defaultConjugations;
                }
            });
            
            completed = new Set();
            streak = 0;
            totalCorrect = 0;
            xp = 0;
            currentVerbIdx = exercises[0].type === "theory" ? 1 : 0; // Saltar teor√≠a si existe
            currentTenseIdx = 0;
            currentStep = 'learn';
            save();
            loadTheory(); // ¬°Importante! Cargar la teor√≠a
            updateUI();
            showSuccess("¬°Archivo cargado exitosamente! üéâ");
        } catch (err) {
            showError("Error al cargar el archivo JSON");
        }
    };
    reader.readAsText(e.target.files[0]);
}

        function celebrate() {
            for (let i = 0; i < 30; i++) {
                setTimeout(() => createConfetti(), i * 30);
            }
        }

        function bigCelebrate() {
            for (let i = 0; i < 100; i++) {
                setTimeout(() => createConfetti(), i * 20);
            }
        }

        function createConfetti() {
            const confetti = document.createElement('div');
            confetti.className = 'confetti';
            confetti.style.left = Math.random() * 100 + '%';
            confetti.style.top = '-10px';
            confetti.style.background = ['#fbbf24', '#10b981', '#3b82f6', '#8b5cf6', '#ec4899'][Math.floor(Math.random() * 5)];
            confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
            document.body.appendChild(confetti);
            setTimeout(() => confetti.remove(), 3000);
        }

        function showError(message) {
            const popup = document.createElement('div');
            popup.style.cssText = `
                position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
                background: linear-gradient(135deg, #fee2e2, #fecaca); color: #991b1b;
                padding: 2rem 3rem; border-radius: 1rem; font-weight: 700; font-size: 1.2rem;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); z-index: 10000;
                border: 3px solid #ef4444; animation: slideUp 0.3s ease-out;
            `;
            popup.innerText = message;
            document.body.appendChild(popup);
            setTimeout(() => {
                popup.style.animation = 'slideUp 0.3s ease-out reverse';
                setTimeout(() => popup.remove(), 300);
            }, 2000);
        }

        function showSuccess(message) {
            const popup = document.createElement('div');
            popup.style.cssText = `
                position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
                background: linear-gradient(135deg, #dcfce7, #bbf7d0); color: #166534;
                padding: 2rem 3rem; border-radius: 1rem; font-weight: 700; font-size: 1.2rem;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); z-index: 10000;
                border: 3px solid #10b981; animation: slideUp 0.3s ease-out;
            `;
            popup.innerText = message;
            document.body.appendChild(popup);
            setTimeout(() => {
                popup.style.animation = 'slideUp 0.3s ease-out reverse';
                setTimeout(() => popup.remove(), 300);
            }, 2000);
        }

        function showVictory() {
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0, 0, 0, 0.8); z-index: 10000;
                display: flex; align-items: center; justify-content: center;
                animation: slideUp 0.5s ease-out;
            `;
            
            overlay.innerHTML = `
                <div style="
                    background: linear-gradient(135deg, #fbbf24, #f59e0b);
                    padding: 4rem; border-radius: 2rem; text-align: center;
                    max-width: 500px; box-shadow: 0 30px 80px rgba(0, 0, 0, 0.5);
                ">
                    <div style="font-size: 5rem; margin-bottom: 1rem;">üèÜ</div>
                    <h2 style="color: white; font-size: 2.5rem; margin-bottom: 1rem; text-shadow: 0 4px 10px rgba(0,0,0,0.3);">
                        ¬°VICTORIA TOTAL!
                    </h2>
                    <p style="color: white; font-size: 1.2rem; margin-bottom: 2rem;">
                        Has completado todos los verbos üéâ
                    </p>
                    <div style="background: white; padding: 1.5rem; border-radius: 1rem; margin-bottom: 2rem;">
                        <p style="font-size: 1.5rem; font-weight: 900; color: #f59e0b;">
                            ${xp} XP Total
                        </p>
                        <p style="color: #64748b; margin-top: 0.5rem;">
                            ${totalCorrect} respuestas correctas
                        </p>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" style="
                        background: white; color: #f59e0b; padding: 1rem 2rem;
                        border-radius: 1rem; border: none; font-weight: 700;
                        cursor: pointer; font-size: 1.1rem;
                    ">
                        Continuar practicando üöÄ
                    </button>
                </div>
            `;
            
            document.body.appendChild(overlay);
            bigCelebrate();
        }

        function getFormalityLevel(verbName) {
    const formalVerbs = ['bewerben', 'beschwerde', 'reklamation', 'praktikum'];
    const informalVerbs = ['einladung', 'party', 'geburtstag'];
    
    const lowerVerb = verbName.toLowerCase();
    
    if (formalVerbs.some(v => lowerVerb.includes(v))) {
        return 'Formal';
    } else if (informalVerbs.some(v => lowerVerb.includes(v))) {
        return 'Informal';
    } else {
        return 'Semi-formal';
    }
}

function getGreetingType(v) {
    if (v.verb.includes('Hallo') || v.conjugations?.pr√§sens?.[0]?.includes('Hallo')) {
        return 'Informal (Hallo ...)';
    } else if (v.verb.includes('Sehr geehrte') || v.tenses?.[0]?.correctSentence?.includes('Sehr')) {
        return 'Formal (Sehr geehrte...)';
    } else {
        return 'Neutral (Guten Tag)';
    }
}

function getClosingType(v) {
    if (v.matching?.some(m => m.a.includes('Mit freundlichen Gr√º√üen'))) {
        return 'Formal (Mit freundlichen Gr√º√üen)';
    } else if (v.verb.includes('Einladung') || v.type === 'email') {
        return 'Amical (Viele Gr√º√üe)';
    } else {
        return 'Standard';
    }
}

function getKeyVocabulary(v) {
    const vocabMap = {
        'hotel': [{german: 'Zimmer', spanish: 'habitaci√≥n'}, {german: 'Reservierung', spanish: 'reserva'}],
        'restaurant': [{german: 'Tisch', spanish: 'mesa'}, {german: 'Reservierung', spanish: 'reserva'}],
        'termin': [{german: 'Treffen', spanish: 'reuni√≥n'}, {german: 'Vorschlag', spanish: 'sugerencia'}],
        'beschwerde': [{german: 'Problem', spanish: 'problema'}, {german: 'Reparatur', spanish: 'reparaci√≥n'}],
        'einladung': [{german: 'Party', spanish: 'fiesta'}, {german: 'Geburtstag', spanish: 'cumplea√±os'}],
        'bewerbung': [{german: 'Praktikum', spanish: 'pr√°cticas'}, {german: 'Lebenslauf', spanish: 'CV'}],
        'absage': [{german: 'Einladung', spanish: 'invitaci√≥n'}, {german: 'Pl√§ne', spanish: 'planes'}],
        'tourismus': [{german: 'Sehensw√ºrdigkeiten', spanish: 'atracciones'}, {german: 'Eintritt', spanish: 'entrada'}],
        'miete': [{german: 'Wohnung', spanish: 'apartamento'}, {german: 'Heizung', spanish: 'calefacci√≥n'}],
        'feedback': [{german: 'Kurs', spanish: 'curso'}, {german: 'Unterricht', spanish: 'clase'}]
    };
    
    const lowerVerb = v.verb.toLowerCase();
    for (const [key, vocab] of Object.entries(vocabMap)) {
        if (lowerVerb.includes(key)) {
            return vocab;
        }
    }
    
    return [{german: 'Email', spanish: 'correo'}, {german: 'Nachricht', spanish: 'mensaje'}];
}

        // Agregar event listeners globales para la ruleta
        window.addEventListener('mousemove', doDrag);
        window.addEventListener('mouseup', stopDrag);
        window.addEventListener('touchmove', doDrag);
        window.addEventListener('touchend', stopDrag);

        // Inicializar la aplicaci√≥n
        init();
    </script>

<script>
/* === ADAPTIVE UI LAYER (SAFE & ISOLATED) === */
(function(){
  // Dark mode toggle
  const btn = document.createElement('button');
  btn.id = 'darkToggle';
  btn.innerText = 'üåô / ‚òÄÔ∏è';
  btn.onclick = () => document.body.classList.toggle('dark');
  document.body.appendChild(btn);

  // Adaptive focus (visual only)
  document.addEventListener('click', e => {
    const ex = e.target.closest('.exercise');
    if(ex){
      document.querySelectorAll('.focus').forEach(x=>x.classList.remove('focus'));
      ex.classList.add('focus');
    }
  });
})();
</script>

<script>
/* === PWA + MODULE SELECTOR (SAFE LAYER) === */
(async function(){
  if ('serviceWorker' in navigator) {
    try { await navigator.serviceWorker.register('./service-worker.js'); }
    catch(e){ console.warn('SW error', e); }
  }

  const input = document.querySelector('input[type="file"]');
  if(!input) return;

  const trigger = input.previousElementSibling || input;

  trigger.addEventListener('click', async (e)=>{
    e.preventDefault();
    try{
      const res = await fetch('./data/index.json');
      const idx = await res.json();
      showSelector(idx.modules);
    }catch(err){
      input.click();
    }
  });

  function showSelector(mods){
    const o = document.createElement('div');
    o.style.cssText='position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:999;display:flex;align-items:center;justify-content:center';
    const p = document.createElement('div');
    p.style.cssText='background:#fff;color:#111;padding:1rem;border-radius:14px;max-width:420px;width:90%';

    p.innerHTML='<h3>Selecciona un m√≥dulo</h3>';

    mods.forEach(m=>{
      const b=document.createElement('button');
      b.textContent=m.title;
      b.style.cssText = `
  display:block;
  width:100%;
  margin:.5rem 0;
  padding:.6rem;
  border-radius:10px;
  background:#f1f3f4;
  color:#111;
  border:1px solid #ccc;
  font-weight:600;
`;

      b.onclick=async()=>{
        const r=await fetch('./data/'+m.file);
        const t=await r.text();
        const f=new File([t],m.file,{type:'application/json'});
        const d=new DataTransfer(); d.items.add(f);
        input.files=d.files;
        input.dispatchEvent(new Event('change'));
        o.remove();
      };
      p.appendChild(b);
    });

    o.appendChild(p);
    document.body.appendChild(o);
  }
})();
</script>


</body>
</html>